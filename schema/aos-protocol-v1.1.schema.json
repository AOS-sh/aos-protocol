{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "AOS Protocol v1.1",
  "type": "object",
  "required": ["version", "site_name", "capabilities"],
  "properties": {
    "version": { "const": "1.1" },
    "site_name": { "type": "string" },
    "description": { "type": "string" },
    "icon": { "type": "string", "format": "uri" },
    "contact": { "type": "string", "format": "email" },

    "capabilities": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["name", "description"],
        "properties": {
          "name": {
            "type": "string",
            "enum": [
              "search", "login", "logout", "signup", "create", "read", "update", "delete",
              "book", "purchase", "checkout", "add_to_cart", "schedule", "upload", "download",
              "comment", "like", "share", "custom"
            ]
          },
          "custom_name": { "type": "string" },                  
          "description": { "type": "string" },
          "path": { "type": "string" },                        
          "method": { "type": "string", "enum": ["GET","POST","PUT","PATCH","DELETE"], "default": "POST" },
          "preferred": { "type": "boolean", "default": false }, 
          "input_schema": { "type": "object" },                 
          "output_schema": { "type": "object" },                 
          "auth_required": { "type": "boolean", "default": false },
          "rate_limit": {
            "type": "object",
            "properties": {
              "requests_per_minute": { "type": "integer" },
              "burst": { "type": "integer" }
            }
          },
          "example_request": { "type": "object" },
          "example_response": { "type": "object" }
        },
        "allOf": [
          {
            "if": { "properties": { "name": { "const": "custom" } } },
            "then": { "required": ["custom_name"] }
          }
        ]
      }
    },

    "authentication": {
      "type": "object",
      "properties": {
        "type": { "enum": ["none", "bearer", "oauth2", "api_key", "nexus"] },
        "login_endpoint": { "type": "string" },
        "token_endpoint": { "type": "string" }
      }
    },

    "telemetry_webhook": { "type": "string", "format": "uri" },
    "locales": { "type": "array", "items": { "type": "string" } },
    "gdpr_portability_endpoint": { "type": "string" }
  }
}